import type { OracleJob } from '../protos.js';
import { Keypair } from '@solana/web3.js';
/**
 * Represents the payment details returned in a 402 Payment Required response
 */
export interface X402PaymentDetails {
    /** Array of accepted payment schemes */
    accepts: Array<{
        /** Payment scheme (e.g., "deferred") */
        scheme: string;
        /** Blockchain network (e.g., "base", "ethereum", "solana") */
        network: string;
        /** Resource URL being paid for */
        resource: string;
        /** Payment amount in smallest unit */
        amount?: string;
        /** Token contract address (for EVM chains) or mint address (for Solana) */
        token?: string;
        /** Payment recipient address */
        recipient?: string;
        /** Additional metadata */
        extras?: Record<string, unknown>;
        /** Any other fields the server includes */
        [key: string]: unknown;
    }>;
}
/**
 * Result of processing an x402 request
 */
export interface X402Result {
    /** Whether a 402 Payment Required response was received */
    is402: boolean;
    /** HTTP status code */
    status: number;
    /** Parsed payment details (only if is402 is true) */
    paymentDetails?: X402PaymentDetails;
    /** Base64-encoded ed25519 signature of the payment details (only if is402 is true) */
    signature?: string;
    /** Response body as JSON (only if not a 402 response) */
    data?: unknown;
    /** Response headers */
    headers: Record<string, string>;
    /** Raw response text */
    text: string;
}
/**
 * Error class for x402-related errors
 */
export declare class X402Error extends Error {
    constructor(message: string);
}
/**
 * Executes an HTTP request based on an HttpTask and handles x402 Payment Required responses.
 *
 * If the response is 402 Payment Required:
 * - Parses the payment details from the response body
 * - Signs the payment details with the provided ed25519 keypair
 * - Returns the payment details and signature for further processing
 *
 * If the response is not 402:
 * - Returns the response data normally
 *
 * @param httpTask - The HttpTask configuration from an OracleJob
 * @param keypair - Ed25519 keypair for signing payment requests (Solana Keypair or Uint8Array secret key)
 * @returns Promise<X402Result> containing the response and optional payment details/signature
 *
 * @example
 * ```typescript
 * import { Keypair } from '@solana/web3.js';
 * import { handleX402Request } from '@switchboard-xyz/common/utils/x402';
 *
 * const httpTask = {
 *   url: 'https://api.x402-service.com/data',
 *   method: 1, // METHOD_GET
 *   headers: [{ key: 'Accept', value: 'application/json' }]
 * };
 *
 * const keypair = Keypair.generate();
 * const result = await handleX402Request(httpTask, keypair);
 *
 * if (result.is402) {
 *   console.log('Payment required:', result.paymentDetails);
 *   console.log('Signature:', result.signature);
 *
 *   // Now you can use the signature to make a payment
 *   // and retry the request with X-PAYMENT header
 * } else {
 *   console.log('Success:', result.data);
 * }
 * ```
 *
 * @example With raw secret key
 * ```typescript
 * const secretKey = new Uint8Array(64); // Your ed25519 secret key
 * const result = await handleX402Request(httpTask, secretKey);
 * ```
 */
export declare function handleX402Request(httpTask: OracleJob.IHttpTask, keypair: Keypair | Uint8Array): Promise<X402Result>;
/**
 * Creates an X-PAYMENT header value for retrying a request after receiving a 402 response.
 * This constructs the header value that should be used in the retry request.
 *
 * @param paymentDetails - The payment details from the 402 response
 * @param signature - The base64-encoded signature from handleX402Request
 * @param publicKey - The public key of the signer (base58 string or Uint8Array)
 * @returns The base64-encoded payment payload for the X-PAYMENT header
 *
 * @example
 * ```typescript
 * const result = await handleX402Request(httpTask, keypair);
 * if (result.is402) {
 *   const paymentHeader = createX402PaymentHeader(
 *     result.paymentDetails!,
 *     result.signature!,
 *     keypair.publicKey.toBase58()
 *   );
 *
 *   // Retry request with payment header
 *   const retryResponse = await fetch(httpTask.url!, {
 *     headers: {
 *       'X-PAYMENT': paymentHeader
 *     }
 *   });
 * }
 * ```
 */
export declare function createX402PaymentHeader(paymentDetails: X402PaymentDetails, signature: string, publicKey: string | Uint8Array): string;
/**
 * Namespace export for compatibility with other utility modules
 */
export declare const X402Utils: {
    handleX402Request: typeof handleX402Request;
    createX402PaymentHeader: typeof createX402PaymentHeader;
};
//# sourceMappingURL=x402.d.ts.map